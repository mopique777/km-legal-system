services:
  - type: web
    name: km-legal-backend
    runtime: python
    buildCommand: pip install -r backend/requirements.txt
    startCommand: cd backend && uvicorn server:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: MONGO_URL
        sync: false
      - key: DB_NAME
        value: km-legal
      - key: GOOGLE_DRIVE_CREDENTIALS
        sync: false
      - key: GOOGLE_GENERATIVE_AI_KEY
        sync: false
    routes:
      - path: /api
        destination: /api

  - type: web
    name: km-legal-frontend
    runtime: node
    buildCommand: cd frontend && npm install --legacy-peer-deps && npm run build
    startCommand: cd frontend && npm install -g serve && serve -s build -l 3000
    envVars: []
    routes:
      - path: /
        destination: /

  - type: pserv
    name: km-legal-mongodb
    plan: free
    ipAllowList: []
